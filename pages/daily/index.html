<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flow On ‚Äî Daily Log</title>
  <link rel="stylesheet" href="../../assets/css/style.css" />
  <link rel="icon" href="../../assets/img/favicon-32.png" />
  <style>
    /* pequenos refor√ßos visuais */
    #dailyRecent .item, #dailyMonthList .item { margin-top:8px; }
    .btn.danger { border-color:#ff6b6b; }
  </style>
</head>
<body>
<header class="navbar">
  <div class="nav-inner" style="justify-content:space-between">
    <a href="../journal/" class="btn small">‚¨ÖÔ∏è Voltar ao Journal</a>
    <nav class="menu">
      <a href="../../index.html">üè† Home</a>
      <a href="../reports/">üìä Relat√≥rios</a>
    </nav>
  </div>
</header>

<main class="container">
  <section class="card" id="tab-daily">
    <h2>Daily Log</h2>

    <div class="form" id="dailyForm" style="max-width:800px">
      <label>Data</label>
      <select id="dailyDate"></select>

      <label>Foco (1 frase)</label>
      <input id="dailyFocus" type="text" placeholder="Foco do dia" />

      <label>3 MITs (separe por ;)</label>
      <input id="dailyMITs" type="text" placeholder="Ex.: Gravar; Editar; Publicar" />

      <label>Gratid√£o (3 itens; ;)</label>
      <input id="dailyGrat" type="text" placeholder="Ex.: Fam√≠lia; Sa√∫de; Cliente X" />

      <label>Humor (1-10)</label>
      <input id="dailyMood" type="number" min="1" max="10" />

      <label>Notas / Reflex√£o</label>
      <textarea id="dailyNotes" rows="6" placeholder="Anota√ß√µes do dia"></textarea>

      <!-- S√≥ o Salvar (removido o Excluir do topo) -->
      <div style="margin-top:8px; display:flex; gap:10px; flex-wrap:wrap">
        <button id="btnSaveDaily" type="button" class="btn">üíæ Salvar Daily</button>
      </div>
    </div>

    <hr style="margin:20px 0; border-color:var(--border); opacity:0.3" />

    <div style="display:flex; align-items:center; gap:10px; margin-top:6px; flex-wrap:wrap">
      <h3 style="margin:0">√öltimos registros</h3>
      <button id="btnToggleDailyMonth" type="button" class="btn small">Ver todos do m√™s</button>
    </div>

    <div id="dailyRecent" style="margin-top:10px"></div>

    <div id="dailyMonth" style="display:none; margin-top:15px;">
      <h3 class="muted" style="margin:6px 0 8px">Registros do m√™s atual</h3>
      <div id="dailyMonthList"></div>
    </div>
  </section>
</main>

<footer class="footer">
  <p>Flow On ¬© 2025 ‚Äî Planeje. Execute. Evolua.</p>
</footer>

<!-- =============== JS EMBUTIDO (aut√¥nomo) =============== -->
<script>
/* Storage simples */
const STORE_KEY = 'flowon';
const Data = {
  _s: null,
  load(){ try{ this._s = JSON.parse(localStorage.getItem(STORE_KEY)||'{}'); }catch(e){ this._s = {}; } },
  save(){ localStorage.setItem(STORE_KEY, JSON.stringify(this._s||{})); },
  get(){ if(!this._s) this.load(); return this._s; }
};
function J(){ const s = Data.get(); s.journal ||= {}; s.journal.daily ||= { byDate:{} }; return s; }

/* Helpers */
const toISO = d => d.toISOString().slice(0,10);
function todayISO(){ const d=new Date(); d.setHours(0,0,0,0); return toISO(d); }
function addDaysISO(iso,n){ const d=new Date(iso+'T00:00:00'); d.setDate(d.getDate()+n); return toISO(d); }
function toBR(iso){ return new Date(iso+'T00:00:00').toLocaleDateString('pt-BR'); }
function monthKey(iso){ const d=new Date(iso+'T00:00:00'); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`; }

/* Populate datas (√∫ltimos 30 + existentes) */
function populateDateOptions(){
  const sel = document.getElementById('dailyDate'); if(!sel) return;
  const s = J();
  const existing = Object.keys(s.journal.daily.byDate||{});
  const base = addDaysISO(todayISO(), -29);
  const set = new Set();
  for(let i=0;i<30;i++){ set.add(addDaysISO(base,i)); }
  existing.forEach(d=>set.add(d));
  const arr = Array.from(set).sort().reverse();
  sel.innerHTML = arr.map(d=>`<option value="${d}">${toBR(d)}</option>`).join('');
  sel.value = arr.includes(todayISO()) ? todayISO() : arr[0];
}

/* Form utils */
function readForm(){
  return {
    date: document.getElementById('dailyDate').value || todayISO(),
    focus: (document.getElementById('dailyFocus').value||'').trim(),
    mits: (document.getElementById('dailyMITs').value||'').trim(),
    gratitude: (document.getElementById('dailyGrat').value||'').trim(),
    mood: Number(document.getElementById('dailyMood').value||0) || null,
    notes: (document.getElementById('dailyNotes').value||'').trim(),
    ts: Date.now()
  };
}
function fillForm(dateISO, rec){
  document.getElementById('dailyDate').value = dateISO;
  document.getElementById('dailyFocus').value = rec?.focus || '';
  document.getElementById('dailyMITs').value = rec?.mits || '';
  document.getElementById('dailyGrat').value = rec?.gratitude || '';
  document.getElementById('dailyMood').value = rec?.mood ?? '';
  document.getElementById('dailyNotes').value = rec?.notes || '';
}
function clearForm(){
  document.getElementById('dailyFocus').value = '';
  document.getElementById('dailyMITs').value = '';
  document.getElementById('dailyGrat').value = '';
  document.getElementById('dailyMood').value = '';
  document.getElementById('dailyNotes').value = '';
}

/* CRUD */
function saveDaily(){
  const s = J(); const r = readForm();
  s.journal.daily.byDate[r.date] = {
    focus:r.focus, mits:r.mits, gratitude:r.gratitude, mood:r.mood, notes:r.notes, ts:r.ts
  };
  Data.save();
  populateDateOptions(); // caso seja novo
  renderDailyRecent();
  renderDailyMonth();
  alert('Daily salvo!');
}
function deleteDaily(dateISO){
  const s = J();
  if(!s.journal.daily.byDate[dateISO]) return;
  delete s.journal.daily.byDate[dateISO];
  Data.save();
  if(document.getElementById('dailyDate').value === dateISO){ clearForm(); }
  populateDateOptions();
  document.getElementById('dailyDate').value = todayISO();
  renderDailyRecent();
  renderDailyMonth();
}

/* Render: √∫ltimos 3 */
function renderDailyRecent(){
  const wrap = document.getElementById('dailyRecent'); if(!wrap) return;
  const s = J();
  const entries = Object.entries(s.journal.daily.byDate)
    .sort((a,b)=> b[0].localeCompare(a[0]))
    .slice(0,3);
  if(entries.length===0){ wrap.innerHTML = `<div class="empty">Sem registros recentes.</div>`; return; }

  wrap.innerHTML = '';
  entries.forEach(([date, rec])=>{
    const el = document.createElement('div');
    el.className = 'item';
    el.innerHTML = `
      <div>
        <strong>${toBR(date)}</strong>
        <div class="muted">Humor: ${rec.mood ?? '‚Äî'}</div>
        <div style="margin-top:6px">
          <div>Foco: ${rec.focus || '‚Äî'}</div>
          <div>Gratid√£o: ${rec.gratitude || '‚Äî'}</div>
          ${rec.mits ? `<div>MITs: ${rec.mits}</div>` : ''}
        </div>
      </div>
      <div class="flex">
        <button class="btn small" data-act="edit" data-date="${date}">Editar</button>
        <button class="btn small danger" data-act="del" data-date="${date}">Excluir</button>
      </div>
    `;
    wrap.appendChild(el);
  });
  bindCardActions(wrap);
}

/* Render: m√™s atual */
function renderDailyMonth(){
  const wrap = document.getElementById('dailyMonthList'); if(!wrap) return;
  const s = J(); const mk = monthKey(todayISO());
  const entries = Object.entries(s.journal.daily.byDate)
    .filter(([d])=> monthKey(d)===mk)
    .sort((a,b)=> b[0].localeCompare(a[0]));
  if(entries.length===0){ wrap.innerHTML = `<div class="empty">Sem registros neste m√™s.</div>`; return; }

  wrap.innerHTML = '';
  entries.forEach(([date, rec])=>{
    const el = document.createElement('div');
    el.className = 'item';
    el.innerHTML = `
      <div>
        <strong>${toBR(date)}</strong>
        <div class="muted">Humor: ${rec.mood ?? '‚Äî'}</div>
        <div style="margin-top:6px">
          <div>Foco: ${rec.focus || '‚Äî'}</div>
          <div>Gratid√£o: ${rec.gratitude || '‚Äî'}</div>
          ${rec.mits ? `<div>MITs: ${rec.mits}</div>` : ''}
        </div>
      </div>
      <div class="flex">
        <button class="btn small" data-act="edit" data-date="${date}">Editar</button>
        <button class="btn small danger" data-act="del" data-date="${date}">Excluir</button>
      </div>
    `;
    wrap.appendChild(el);
  });
  bindCardActions(wrap);
}

/* Liga bot√µes dos cart√µes */
function bindCardActions(scope){
  scope.querySelectorAll('[data-act="edit"]').forEach(b=>{
    b.onclick = ()=>{ const d=b.dataset.date; const s=J(); fillForm(d, s.journal.daily.byDate[d]||null); window.scrollTo({top:0,behavior:'smooth'}); };
  });
  scope.querySelectorAll('[data-act="del"]').forEach(b=>{
    b.onclick = ()=>{ const d=b.dataset.date; if(confirm('Excluir este registro di√°rio?')) deleteDaily(d); };
  });
}

/* Toggle ver m√™s */
function bindToggleMonth(){
  const btn = document.getElementById('btnToggleDailyMonth');
  const box = document.getElementById('dailyMonth');
  if(!btn || !box) return;
  btn.onclick = ()=>{
    const open = box.style.display !== 'none';
    box.style.display = open ? 'none' : 'block';
    btn.textContent = open ? 'Ver todos do m√™s' : 'Ocultar';
  };
}

/* Bind dos bot√µes principais (apenas salvar e troca de data) */
function bindTopButtons(){
  document.getElementById('btnSaveDaily').onclick = saveDaily;
  document.getElementById('dailyDate').onchange = ()=>{
    const d = document.getElementById('dailyDate').value;
    const s = J(); fillForm(d, s.journal.daily.byDate[d] || null);
  };
}

/* Boot */
document.addEventListener('DOMContentLoaded', ()=>{
  Data.load();
  populateDateOptions();
  const s = J(); if(s.journal.daily.byDate[todayISO()]) fillForm(todayISO(), s.journal.daily.byDate[todayISO()]);
  bindTopButtons();
  bindToggleMonth();
  renderDailyRecent();
  renderDailyMonth();
});
</script>
<!-- ============= FIM JS EMBUTIDO ============= -->
</body>
</html>
```Ó®Å0Ó®Ç
