<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flow On â€” Mind Flow (DiÃ¡rio)</title>

  <link rel="stylesheet" href="../../assets/css/style.css" />
  <link rel="icon" href="../../assets/img/favicon-32.png" />
  <link rel="manifest" href="../../manifest.webmanifest" />
  <meta name="theme-color" content="#0b0d10" />

  <style>
    .mf-wrap{max-width:900px;margin:0 auto}
    .mf-badge{border:1px solid var(--border);border-radius:999px;padding:4px 10px;font-size:.85rem;opacity:.85}
    .mf-quote{font-size:1.05rem;line-height:1.6;white-space:pre-line}
    .mf-meta{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .mf-card{border:1px solid var(--border);border-radius:16px;padding:14px;background:rgba(255,255,255,.02)}
    .mf-grid{display:grid;grid-template-columns:1fr;gap:14px}
    .mf-label{font-size:.85rem;opacity:.8;margin-bottom:4px}
    textarea{width:100%;min-height:120px}
    .pill{border:1px solid var(--border);border-radius:999px;padding:3px 8px;font-size:.8rem;opacity:.9}
    .muted-small{font-size:.85rem;opacity:.7}
  </style>
</head>
<body>
  <header class="navbar">
    <div class="nav-inner" style="justify-content:space-between">
      <div class="logo">
        <img src="../../assets/img/logo.svg" alt="Flow On logo" />
        <span>Flow On</span>
      </div>
      <nav class="menu">
        <a href="../../index.html">ğŸ  Home</a>
        <a href="../journal/">ğŸ““ Journal</a>
        <a href="../themes/">ğŸ¬ Temas</a>
        <a href="../settings/">âš™ï¸ ConfiguraÃ§Ãµes</a>
      </nav>
    </div>
  </header>

  <main class="container mf-wrap">
    <section class="card">
      <div class="card-head">
        <h2 style="margin:0">Mind Flow â€” ReflexÃ£o de Hoje</h2>
        <a class="btn small" href="./db.html">ğŸ§° Base de dados</a>
      </div>

      <div id="todayBox" class="mf-card">
        <div class="mf-meta" style="justify-content:space-between;margin-bottom:8px">
          <div class="mf-meta">
            <span class="mf-badge" id="mfDayBadge">Dia 1/365</span>
            <span class="pill" id="mfSourcePill">â€”</span>
          </div>
          <div class="muted-small" id="mfDateLabel">â€”</div>
        </div>

        <h3 id="mfTitle" style="margin:0 0 6px">TÃ­tulo</h3>
        <div class="mf-quote" id="mfQuote">â€œCitaÃ§Ã£o / texto base â€¦â€</div>

        <div class="mf-grid" style="margin-top:12px">
          <div class="mf-card">
            <div class="mf-label">ComentÃ¡rio / interpretaÃ§Ã£o</div>
            <div id="mfComment">â€”</div>
          </div>
          <div class="mf-card">
            <div class="mf-label">PrÃ¡tica do dia</div>
            <div id="mfPractice">â€”</div>
          </div>
        </div>

        <div class="mf-grid" style="margin-top:12px">
          <div>
            <div class="mf-label">Minhas notas</div>
            <textarea id="mfNote" placeholder="Escreva algo breve sobre como aplicou hojeâ€¦"></textarea>
          </div>
          <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
            <button id="btnSave" class="btn">Salvar anotaÃ§Ã£o</button>
            <button id="btnDone" class="btn">Marcar como concluÃ­do</button>
            <span id="mfStatus" class="muted-small">â€”</span>
          </div>
        </div>
      </div>

      <div style="margin-top:10px" class="muted-small" id="mfHint">
        Dica: vocÃª pode cadastrar/editar todos os dias em <b>ğŸ§° Base de dados</b>. Se algum dia nÃ£o estiver preenchido, mostramos espaÃ§os em branco.
      </div>
    </section>

    <section class="card">
      <h3>Explorar por nÃºmero</h3>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <input id="jumpInput" class="small" type="number" min="1" max="365" placeholder="Dia (1â€“365)" />
        <button id="btnJump" class="btn small">Ir</button>
        <span class="muted-small">Navega sem alterar a lÃ³gica de repetiÃ§Ã£o anual.</span>
      </div>
    </section>
  </main>

  <footer class="footer"><p>Flow On Â© 2025 â€” Planeje. Execute. Evolua.</p></footer>

  <script>
  /* ===== Mind Flow â€” data layer (v2, localStorage) ===== */
  const KEY = 'flowon.v2';

  const DB = {
    s: {},
    load(){
      try{ this.s = JSON.parse(localStorage.getItem(KEY)||'{}'); }catch(e){ this.s={}; }
      this.s.mindflow ||= { days:{}, logsByDate:{} };
      this.s.mindflow.days    ||= {};
      this.s.mindflow.logsByDate ||= {};
      // semente mÃ­nima (se desejar, remova depois)
      if(Object.keys(this.s.mindflow.days).length === 0){
        const seed = [
          {n:1,  source:'HermÃ©tica', title:'Tudo Ã© Mente', quote:'â€œO Universo Ã© mental.â€', comment:'Seu filtro interno modela a experiÃªncia.', practice:'5 min de observaÃ§Ã£o de pensamentos. Nomeie, nÃ£o julgue.'},
          {n:2,  source:'HermÃ©tica', title:'VibraÃ§Ã£o', quote:'â€œNada estÃ¡ parado.â€', comment:'Humor e energia oscilam â€” navegue, nÃ£o lute.', practice:'RespiraÃ§Ã£o 4-7-8 por 3 ciclos.'},
          {n:3,  source:'Taoista',   title:'Wu-Wei', quote:'â€œA nÃ£o-forÃ§a vence.â€', comment:'Reduza esforÃ§o inÃºtil, foque o essencial.', practice:'Remover 1 tarefa que nÃ£o precisa de vocÃª.'},
          {n:4,  source:'Taoista',   title:'Centro', quote:'â€œO caminho do meio.â€', comment:'Evite extremos, encontre o ritmo sustentÃ¡vel.', practice:'Pausa de 10 min sem telas.'},
          {n:5,  source:'Estoico',   title:'Dicotomia do controle', quote:'â€œAlgumas coisas dependem de nÃ³s.â€', comment:'Escolha bem sua resposta.', practice:'Escreva 1 coisa que controla e 1 que nÃ£o controla.'},
          {n:6,  source:'Estoico',   title:'ProntidÃ£o', quote:'â€œTreine o pior, aja no melhor.â€', comment:'Antecipe obstÃ¡culos com serenidade.', practice:'Plano IF/THEN para 1 gatilho.'},
          {n:7,  source:'Evangelho', title:'Caridade', quote:'â€œFora da caridade nÃ£o hÃ¡ salvaÃ§Ã£o.â€', comment:'Bondade prÃ¡tica reordena o coraÃ§Ã£o.', practice:'1 ato simples de serviÃ§o hoje.'},
        ];
        seed.forEach(d => DB.setDay(d.n, d));
        DB.save();
      }
    },
    save(){ localStorage.setItem(KEY, JSON.stringify(this.s)); },
    getDay(n){ return (this.s.mindflow.days||{})[String(n)] || null; },
    setDay(n, obj){
      this.s.mindflow.days ||= {};
      this.s.mindflow.days[String(n)] = {
        source: obj.source||'â€”',
        title: obj.title||'â€”',
        quote: obj.quote||'',
        comment: obj.comment||'',
        practice: obj.practice||''
      };
    },
    logToday(iso, payload){ // {day, note, done}
      this.s.mindflow.logsByDate ||= {};
      this.s.mindflow.logsByDate[iso] = { ...(this.s.mindflow.logsByDate[iso]||{}), ...payload };
    },
    getLog(iso){ return (this.s.mindflow.logsByDate||{})[iso] || {}; }
  };

  // util datas
  const toISO = d => { const x = new Date(d.getFullYear(), d.getMonth(), d.getDate()); return x.toISOString().slice(0,10); };
  const todayISO = () => toISO(new Date());
  function dayOfYear(d=new Date()){
    const start = new Date(d.getFullYear(),0,1);
    const diff  = Math.floor((d - start)/86400000)+1;
    return diff>365 ? 365 : diff; // ignora 29/fev (mapa para 365)
  }

  // estado UI
  let currentN = null;

  function render(n){
    const iso = todayISO();
    const dateLabel = new Date().toLocaleDateString('pt-BR', { weekday:'long', day:'2-digit', month:'long' });

    const d = DB.getDay(n) || { source:'â€”', title:'(vazio)', quote:'', comment:'', practice:'' };
    const log = DB.getLog(iso);

    document.getElementById('mfDayBadge').textContent = `Dia ${n}/365`;
    document.getElementById('mfSourcePill').textContent = d.source||'â€”';
    document.getElementById('mfTitle').textContent = d.title||'(vazio)';
    document.getElementById('mfQuote').textContent = d.quote||'â€”';
    document.getElementById('mfComment').textContent = d.comment||'â€”';
    document.getElementById('mfPractice').textContent = d.practice||'â€”';
    document.getElementById('mfDateLabel').textContent = dateLabel;

    const noteEl = document.getElementById('mfNote');
    noteEl.value = (log.note||'');

    const status = (log.done? 'âœ” concluÃ­do hoje' : 'pendente');
    document.getElementById('mfStatus').textContent = status;

    currentN = n;
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    DB.load();
    const n = dayOfYear();
    render(n);

    document.getElementById('btnSave').onclick = ()=>{
      const iso = todayISO();
      DB.logToday(iso, { day: currentN, note: document.getElementById('mfNote').value });
      DB.save();
      document.getElementById('mfStatus').textContent = DB.getLog(iso).done ? 'âœ” concluÃ­do hoje' : 'anotado (pendente)';
    };

    document.getElementById('btnDone').onclick = ()=>{
      const iso = todayISO();
      DB.logToday(iso, { day: currentN, done:true, note: document.getElementById('mfNote').value });
      DB.save();
      document.getElementById('mfStatus').textContent = 'âœ” concluÃ­do hoje';
    };

    document.getElementById('btnJump').onclick = ()=>{
      const v = Number(document.getElementById('jumpInput').value||'');
      if(v>=1 && v<=365) render(v);
    };
  });
  </script>
</body>
</html>