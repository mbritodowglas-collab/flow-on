<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flow On — Mind Flow (Diário)</title>

  <link rel="stylesheet" href="../../assets/css/style.css" />
  <link rel="icon" href="../../assets/img/favicon-32.png" />
  <link rel="manifest" href="../../manifest.webmanifest" />
  <meta name="theme-color" content="#0b0d10" />

  <style>
    .mf-wrap{max-width:900px;margin:0 auto}
    .mf-badge{border:1px solid var(--border);border-radius:999px;padding:4px 10px;font-size:.85rem;opacity:.85}
    .mf-quote{font-size:1.05rem;line-height:1.6;white-space:pre-line}
    .mf-meta{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .mf-card{border:1px solid var(--border);border-radius:16px;padding:14px;background:rgba(255,255,255,.02)}
    .mf-grid{display:grid;grid-template-columns:1fr;gap:14px}
    .mf-label{font-size:.85rem;opacity:.8;margin-bottom:4px}
    textarea{width:100%;min-height:120px}
    .pill{border:1px solid var(--border);border-radius:999px;padding:3px 8px;font-size:.8rem;opacity:.9}
    .muted-small{font-size:.85rem;opacity:.7}
  </style>
</head>
<body>
  <header class="navbar">
    <div class="nav-inner" style="justify-content:space-between">
      <div class="logo">
        <img src="../../assets/img/logo.svg" alt="Flow On logo" />
        <span>Flow On</span>
      </div>
      <nav class="menu">
        <a href="../../index.html">🏠 Home</a>
        <a href="../journal/">📓 Journal</a>
        <a href="../themes/">🎬 Temas</a>
        <a href="../settings/">⚙️ Configurações</a>
      </nav>
    </div>
  </header>

  <main class="container mf-wrap">
    <section class="card">
      <div class="card-head">
        <h2 style="margin:0">Mind Flow — Reflexão de Hoje</h2>
        <a class="btn small" href="./db.html">🧰 Base de dados</a>
      </div>

      <div id="todayBox" class="mf-card">
        <div class="mf-meta" style="justify-content:space-between;margin-bottom:8px">
          <div class="mf-meta">
            <span class="mf-badge" id="mfDayBadge">Dia 1/365</span>
            <span class="pill" id="mfSourcePill">—</span>
          </div>
          <div class="muted-small" id="mfDateLabel">—</div>
        </div>

        <h3 id="mfTitle" style="margin:0 0 6px">Título</h3>
        <div class="mf-quote" id="mfQuote">“Citação / texto base …”</div>

        <div class="mf-grid" style="margin-top:12px">
          <div class="mf-card">
            <div class="mf-label">Comentário / interpretação</div>
            <div id="mfComment">—</div>
          </div>
          <div class="mf-card">
            <div class="mf-label">Prática do dia</div>
            <div id="mfPractice">—</div>
          </div>
        </div>

        <div class="mf-grid" style="margin-top:12px">
          <div>
            <div class="mf-label">Minhas notas</div>
            <textarea id="mfNote" placeholder="Escreva algo breve sobre como aplicou hoje…"></textarea>
          </div>
          <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
            <button id="btnSave" class="btn">Salvar anotação</button>
            <button id="btnDone" class="btn">Marcar como concluído</button>
            <span id="mfStatus" class="muted-small">—</span>
          </div>
        </div>
      </div>

      <div style="margin-top:10px" class="muted-small" id="mfHint">
        Dica: você pode cadastrar/editar todos os dias em <b>🧰 Base de dados</b>. Se algum dia não estiver preenchido, mostramos espaços em branco.
      </div>
    </section>

    <section class="card">
      <h3>Explorar por número</h3>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <input id="jumpInput" class="small" type="number" min="1" max="365" placeholder="Dia (1–365)" />
        <button id="btnJump" class="btn small">Ir</button>
        <span class="muted-small">Navega sem alterar a lógica de repetição anual.</span>
      </div>
    </section>
  </main>

  <footer class="footer"><p>Flow On © 2025 — Planeje. Execute. Evolua.</p></footer>

  <script>
  /* ===== Mind Flow — data layer (v2, localStorage) ===== */
  const KEY = 'flowon.v2';

  const DB = {
    s: {},
    load(){
      try{ this.s = JSON.parse(localStorage.getItem(KEY)||'{}'); }catch(e){ this.s={}; }
      this.s.mindflow ||= { days:{}, logsByDate:{} };
      this.s.mindflow.days    ||= {};
      this.s.mindflow.logsByDate ||= {};
      // semente mínima (se desejar, remova depois)
      if(Object.keys(this.s.mindflow.days).length === 0){
        const seed = [
          {n:1,  source:'Hermética', title:'Tudo é Mente', quote:'“O Universo é mental.”', comment:'Seu filtro interno modela a experiência.', practice:'5 min de observação de pensamentos. Nomeie, não julgue.'},
          {n:2,  source:'Hermética', title:'Vibração', quote:'“Nada está parado.”', comment:'Humor e energia oscilam — navegue, não lute.', practice:'Respiração 4-7-8 por 3 ciclos.'},
          {n:3,  source:'Taoista',   title:'Wu-Wei', quote:'“A não-força vence.”', comment:'Reduza esforço inútil, foque o essencial.', practice:'Remover 1 tarefa que não precisa de você.'},
          {n:4,  source:'Taoista',   title:'Centro', quote:'“O caminho do meio.”', comment:'Evite extremos, encontre o ritmo sustentável.', practice:'Pausa de 10 min sem telas.'},
          {n:5,  source:'Estoico',   title:'Dicotomia do controle', quote:'“Algumas coisas dependem de nós.”', comment:'Escolha bem sua resposta.', practice:'Escreva 1 coisa que controla e 1 que não controla.'},
          {n:6,  source:'Estoico',   title:'Prontidão', quote:'“Treine o pior, aja no melhor.”', comment:'Antecipe obstáculos com serenidade.', practice:'Plano IF/THEN para 1 gatilho.'},
          {n:7,  source:'Evangelho', title:'Caridade', quote:'“Fora da caridade não há salvação.”', comment:'Bondade prática reordena o coração.', practice:'1 ato simples de serviço hoje.'},
        ];
        seed.forEach(d => DB.setDay(d.n, d));
        DB.save();
      }
    },
    save(){ localStorage.setItem(KEY, JSON.stringify(this.s)); },
    getDay(n){ return (this.s.mindflow.days||{})[String(n)] || null; },
    setDay(n, obj){
      this.s.mindflow.days ||= {};
      this.s.mindflow.days[String(n)] = {
        source: obj.source||'—',
        title: obj.title||'—',
        quote: obj.quote||'',
        comment: obj.comment||'',
        practice: obj.practice||''
      };
    },
    logToday(iso, payload){ // {day, note, done}
      this.s.mindflow.logsByDate ||= {};
      this.s.mindflow.logsByDate[iso] = { ...(this.s.mindflow.logsByDate[iso]||{}), ...payload };
    },
    getLog(iso){ return (this.s.mindflow.logsByDate||{})[iso] || {}; }
  };

  // util datas
  const toISO = d => { const x = new Date(d.getFullYear(), d.getMonth(), d.getDate()); return x.toISOString().slice(0,10); };
  const todayISO = () => toISO(new Date());
  function dayOfYear(d=new Date()){
    const start = new Date(d.getFullYear(),0,1);
    const diff  = Math.floor((d - start)/86400000)+1;
    return diff>365 ? 365 : diff; // ignora 29/fev (mapa para 365)
  }

  // estado UI
  let currentN = null;

  function render(n){
    const iso = todayISO();
    const dateLabel = new Date().toLocaleDateString('pt-BR', { weekday:'long', day:'2-digit', month:'long' });

    const d = DB.getDay(n) || { source:'—', title:'(vazio)', quote:'', comment:'', practice:'' };
    const log = DB.getLog(iso);

    document.getElementById('mfDayBadge').textContent = `Dia ${n}/365`;
    document.getElementById('mfSourcePill').textContent = d.source||'—';
    document.getElementById('mfTitle').textContent = d.title||'(vazio)';
    document.getElementById('mfQuote').textContent = d.quote||'—';
    document.getElementById('mfComment').textContent = d.comment||'—';
    document.getElementById('mfPractice').textContent = d.practice||'—';
    document.getElementById('mfDateLabel').textContent = dateLabel;

    const noteEl = document.getElementById('mfNote');
    noteEl.value = (log.note||'');

    const status = (log.done? '✔ concluído hoje' : 'pendente');
    document.getElementById('mfStatus').textContent = status;

    currentN = n;
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    DB.load();
    const n = dayOfYear();
    render(n);

    document.getElementById('btnSave').onclick = ()=>{
      const iso = todayISO();
      DB.logToday(iso, { day: currentN, note: document.getElementById('mfNote').value });
      DB.save();
      document.getElementById('mfStatus').textContent = DB.getLog(iso).done ? '✔ concluído hoje' : 'anotado (pendente)';
    };

    document.getElementById('btnDone').onclick = ()=>{
      const iso = todayISO();
      DB.logToday(iso, { day: currentN, done:true, note: document.getElementById('mfNote').value });
      DB.save();
      document.getElementById('mfStatus').textContent = '✔ concluído hoje';
    };

    document.getElementById('btnJump').onclick = ()=>{
      const v = Number(document.getElementById('jumpInput').value||'');
      if(v>=1 && v<=365) render(v);
    };
  });
  </script>
</body>
</html>