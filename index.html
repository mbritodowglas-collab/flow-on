<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flow On â€” Sua Rotina em Movimento</title>
  <link rel="stylesheet" href="assets/css/style.css" />
  <link rel="icon" href="assets/img/favicon-32.png" />
  <style>
    /* --- extras visuais dos novos cards --- */
    .fo-card{border:1px solid var(--border);border-radius:16px;padding:14px;margin:14px 0;background:rgba(255,255,255,.02)}
    .fo-title{font-size:1.2rem;font-weight:700;margin:0 0 8px}
    .fo-muted{opacity:.7}
    .fo-kpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;margin-top:8px}
    .fo-kpi{border:1px solid var(--border);border-radius:12px;padding:12px}
    .fo-kpi strong{font-size:1.3rem}
    .fo-dots{display:grid;grid-template-columns:repeat(21,10px);gap:6px;margin-top:8px}
    .fo-dot{width:10px;height:10px;border-radius:50%;border:1px solid var(--border);opacity:.6}
    .fo-dot.on{background:linear-gradient(180deg,#50fa7b,#2ecc71);border-color:transparent;opacity:1}
    .fo-habit-row{margin:10px 0}
    .fo-habit-name{font-weight:600;margin-bottom:6px}
    .fo-link{color:#7aa2ff;text-decoration:underline}
  </style>
</head>
<body>
  <header class="navbar">
    <div class="nav-inner">
      <div class="logo">
        <img src="assets/img/logo.svg" alt="Flow On logo" />
        <span>Flow On</span>
      </div>
      <nav class="menu">
        <a href="./index.html" class="active">ğŸ  Home</a>
        <a href="pages/journal/">ğŸ““ Journal</a>
        <a href="pages/themes/">ğŸ¬ Temas</a>
        <a href="pages/settings/">âš™ï¸ ConfiguraÃ§Ãµes</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- Progresso Geral -->
    <section class="fo-card" id="progress-card">
      <h2 class="fo-title">Progresso Geral</h2>
      <div class="fo-kpis">
        <div class="fo-kpi"><div class="fo-muted">HÃ¡bitos (semana)</div><strong id="kpi-habits">â€”</strong></div>
        <div class="fo-kpi"><div class="fo-muted">Dailies (7 dias)</div><strong id="kpi-dailies">0</strong></div>
        <div class="fo-kpi"><div class="fo-muted">ConteÃºdos (prÃ³x. 7 dias)</div><strong id="kpi-posts">0</strong></div>
      </div>
    </section>

    <!-- VisÃ£o do Trimestre -->
    <section class="fo-card" id="quarter-card">
      <h2 class="fo-title">VisÃ£o do Trimestre <span class="fo-muted" id="quarter-label"></span></h2>
      <div class="fo-muted" id="quarter-notes" style="white-space:pre-line">Sem anotaÃ§Ãµes do trimestre ainda.</div>
      <div style="margin-top:8px">
        <a class="fo-link" href="pages/quarterly/">Abrir pÃ¡gina do Trimestral</a>
      </div>
    </section>

    <!-- HÃ¡bitos -->
    <section class="card" id="habits-card">
      <h2>HÃ¡bitos da Semana</h2>
      <div id="habits-summary"><p>Carregando hÃ¡bitos...</p></div>
      <button id="btn-habits-21" class="btn small" style="margin-top:8px">ğŸ“ˆ 21 dias</button>
      <div id="habits-21-panel" style="display:none"></div>
    </section>

    <!-- Agenda de ConteÃºdo -->
    <section class="card">
      <h2>Agenda de ConteÃºdo</h2>
      <div id="content-summary">
        <p>Carregando publicaÃ§Ãµes...</p>
      </div>
    </section>

    <!-- Resumo do Journal -->
    <section class="card">
      <h2>Resumo do Journal</h2>
      <div id="journal-summary">
        <p>Carregando registros...</p>
      </div>
    </section>
  </main>

  <footer class="footer">
    <p>Flow On Â© 2025 â€” Planeje. Execute. Evolua.</p>
  </footer>

  <!-- seu JS atual da home (mantÃ©m os blocos jÃ¡ existentes) -->
  <script src="assets/js/app.js"></script>

  <!-- script adicional: KPIs, Trimestral robusto e painel de 21 dias -->
  <script>
  (function(){
    const KEY='flowon';
    let S={}; try{ S=JSON.parse(localStorage.getItem(KEY)||'{}'); }catch(e){S={};}
    const J=()=>{ S.journal ||= {}; return S.journal; };

    // helpers
    const toISO=d=>d.toISOString().slice(0,10);
    const todayISO=()=>{const d=new Date(); d.setHours(0,0,0,0); return toISO(d);};
    const addDays=(iso,n)=>{const d=new Date(iso+'T00:00:00'); d.setDate(d.getDate()+n); return toISO(d);};
    const firstDow=(iso=todayISO())=>{const d=new Date(iso+'T00:00:00'); const k=(d.getDay()+6)%7; d.setDate(d.getDate()-k); return toISO(d);};
    const qKey=(y,q)=>`${y}-T${q}`, qLabel=(y,q)=>`T${q} de ${y}`;
    const quarter=iso=>{const d=new Date(iso+'T00:00:00'); return {year:d.getFullYear(), q:Math.floor(d.getMonth()/3)+1};};

    // ===== KPIs =====
    (function(){
      let habitsPct='â€”', d7='0', posts7='0';
      try{
        const H=J().habits;
        if(H?.items?.length){
          const ids=H.items.map(h=>h.id||h.key||h.title);
          const start=firstDow(); let done=0,total=ids.length*7;
          for(let i=0;i<7;i++){
            const d=addDays(start,i), m=H.marks?.[d];
            if(m){
              ids.forEach(id=>{
                const v = Array.isArray(m) ? m.includes(id) : (typeof m==='object' && !!m[id]);
                if(v) done++;
              });
            }
          }
          habitsPct = total? (Math.round(done/total*100)+'%') : 'â€”';
        }
      }catch(e){}
      try{
        const D=J().daily?.byDate||{};
        let c=0; for(let i=0;i<7;i++){ const d=addDays(todayISO(),-i); const v=D[d]; if(v&&(v.focus||v.notes||v.mits||v.gratitude)) c++; }
        d7=String(c);
      }catch(e){}
      try{
        const sched=(S.content?.scheduled)||(S.themes?.scheduled)||{};
        let c=0; for(let i=0;i<7;i++){ const d=addDays(todayISO(),i); const a=sched[d]; if(Array.isArray(a)) c+=a.length; else if(a&&typeof a==='object') c+=Object.keys(a).length; }
        posts7=String(c);
      }catch(e){}
      (document.getElementById('kpi-habits')||{}).textContent = habitsPct;
      (document.getElementById('kpi-dailies')||{}).textContent = d7;
      (document.getElementById('kpi-posts')||{}).textContent = posts7;
    })();

    // ===== VisÃ£o do Trimestre (lÃª vÃ¡rias estruturas possÃ­veis) =====
    (function(){
      const {year,q}=quarter(todayISO());
      const key = qKey(year,q);
      const lbl = document.getElementById('quarter-label');
      const out = document.getElementById('quarter-notes');
      if(lbl) lbl.textContent = `(${qLabel(year,q)})`;

      const roots = [
        J().tri,          // { byQuarter: { 'YYYY-TQ': '...' } }
        J().quarterly,
        J().trimestral,
        J()               // fallback: journal['YYYY-TQ']
      ].filter(Boolean);

      let notes='';
      for(const r of roots){
        if(notes) break;
        if(r.byQuarter && r.byQuarter[key]) { notes = r.byQuarter[key]; break; }
        if(r[key]) { notes = r[key]; break; }
      }
      if(!notes){
        const anyRoot = roots.find(r=>typeof r==='object');
        if(anyRoot){
          const k = Object.keys(anyRoot).find(k=>k.endsWith(key));
          if(k) notes = anyRoot[k];
        }
      }
      if(out) out.textContent = notes || 'Sem anotaÃ§Ãµes do trimestre ainda.';
    })();

    // ===== HÃ¡bitos â€” painel "ğŸ“ˆ 21 dias" =====
    (function(){
      const H=J().habits;
      const btn=document.getElementById('btn-habits-21');
      const panel=document.getElementById('habits-21-panel');

      if(!btn || !panel) return;

      if(!H?.items?.length){
        btn.style.display='none';
        return;
      }

      function build(){
        panel.innerHTML='';
        H.items.forEach(h=>{
          const id=h.id||h.key||h.title;
          const row=document.createElement('div'); row.className='fo-habit-row';
          const name=document.createElement('div'); name.className='fo-habit-name'; name.textContent=h.title||id;
          const grid=document.createElement('div'); grid.className='fo-dots';
          for(let i=20;i>=0;i--){
            const d=addDays(todayISO(),-i), m=H.marks?.[d];
            const on = m ? (Array.isArray(m)?m.includes(id):!!m[id]) : false;
            const dot=document.createElement('div'); dot.className='fo-dot'+(on?' on':''); dot.title=d;
            grid.appendChild(dot);
          }
          row.appendChild(name); row.appendChild(grid); panel.appendChild(row);
        });
      }

      btn.onclick=()=>{
        const open = panel.style.display!=='none';
        if(open){ panel.style.display='none'; btn.textContent='ğŸ“ˆ 21 dias'; }
        else { build(); panel.style.display='block'; btn.textContent='Ocultar 21 dias'; }
      };
    })();
  })();
  </script>
</body>
</html>
