<!DOCTYPE html><html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flow On ‚Äî v1 ‚Ä¢ SPA</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0b0b0b; --card:#121212; --muted:#1c1c1c; --brand:#e32526; --gold:#e0a96d; --text:#f5f5f5; }
    html,body{height:100%;background:var(--bg);color:var(--text);font-family:'Open Sans',system-ui,Roboto}
    .title{font-family:'Montserrat',sans-serif}
    .glass{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.06)}
    .btn{background:#151515;border:1px solid rgba(255,255,255,.08)}
    .btn:hover{border-color:rgba(255,255,255,.18)}
    .badge{background:#141414;border:1px solid rgba(255,255,255,.06)}
    input,select,textarea{background:#121212;border:1px solid rgba(255,255,255,.08);border-radius:.6rem;padding:.6rem .8rem}
    .divider{border-top:1px dashed rgba(255,255,255,.08)}
    .ring-dot{width:22px;height:22px;border-radius:9999px;border:2px solid rgba(255,255,255,.15);display:grid;place-items:center;}
    .ring-dot.done{border-color:#22c55e;box-shadow:0 0 0 2px rgba(34,197,94,.25)} /* aro verde */
  </style>
</head>
<body>
  <!-- NAV -->
  <header class="sticky top-0 z-40 bg-black/60 backdrop-blur border-b border-white/10">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
      <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-red-600 to-amber-400 grid place-items-center text-black font-bold">ON</div>
      <h1 class="title text-lg">Flow On <span class="text-white/50">‚Äî v1</span></h1>
      <nav class="ml-auto flex gap-2">
        <a href="#/" class="btn px-3 py-2 rounded-md text-sm" data-link>üè† Home</a>
        <a href="#/journal" class="btn px-3 py-2 rounded-md text-sm" data-link>üìì Journal</a>
        <a href="#/themes" class="btn px-3 py-2 rounded-md text-sm" data-link>üé¨ Temas</a>
      </nav>
    </div>
  </header>  <!-- ROOT -->  <main id="app" class="max-w-7xl mx-auto px-4 py-6"></main>  <template id="homeTpl">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Habit Tracker Semana -->
      <section class="glass rounded-2xl p-5 lg:col-span-1">
        <div class="flex items-center justify-between mb-3">
          <h2 class="title text-lg">H√°bitos (semana)</h2>
          <a href="#/journal?tab=habits" class="text-xs underline">abrir h√°bitos</a>
        </div>
        <div id="homeHabits"></div>
      </section>
      <!-- Agenda Conte√∫do Semana -->
      <section class="glass rounded-2xl p-5 lg:col-span-1">
        <div class="flex items-center justify-between mb-3">
          <h2 class="title text-lg">Agenda de Conte√∫do</h2>
          <a href="#/themes" class="text-xs underline">abrir temas</a>
        </div>
        <div id="homeContent"></div>
      </section>
      <!-- Agenda BJ Semana -->
      <section class="glass rounded-2xl p-5 lg:col-span-1">
        <div class="flex items-center justify-between mb-3">
          <h2 class="title text-lg">Agenda do Journal</h2>
          <a href="#/journal" class="text-xs underline">abrir journal</a>
        </div>
        <div id="homeJournal"></div>
      </section>
    </div>
  </template>  <template id="journalTpl">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
      <aside class="lg:col-span-1">
        <div class="glass rounded-2xl p-4 space-y-2">
          <a data-tab="habits" class="tab btn w-full px-3 py-2 rounded-md text-left">H√°bitos</a>
          <a data-tab="daily" class="tab btn w-full px-3 py-2 rounded-md text-left">Daily Log</a>
          <a data-tab="monthly" class="tab btn w-full px-3 py-2 rounded-md text-left">Monthly Log</a>
          <a data-tab="quarter" class="tab btn w-full px-3 py-2 rounded-md text-left">Trimestral Log</a>
        </div>
      </aside>
      <section class="lg:col-span-3">
        <div id="journalView"></div>
      </section>
    </div>
  </template>  <template id="themesTpl">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Ideias -->
      <section class="glass rounded-2xl p-5">
        <div class="flex items-center justify-between mb-3">
          <h2 class="title text-lg">Banco de Ideias</h2>
          <button id="btnAddIdea" class="btn px-3 py-2 rounded-md text-sm">+ Ideia</button>
        </div>
        <div id="ideasList" class="space-y-2"></div>
      </section>
      <!-- Rascunhos -->
      <section class="glass rounded-2xl p-5">
        <div class="flex items-center justify-between mb-3">
          <h2 class="title text-lg">Rascunhos</h2>
        </div>
        <div id="draftsList" class="space-y-2"></div>
      </section>
      <!-- Agenda de Publica√ß√£o (semana) -->
      <section class="glass rounded-2xl p-5">
        <div class="flex items-center justify-between mb-3">
          <h2 class="title text-lg">Publica√ß√£o (semana)</h2>
          <button id="btnNewTheme" class="btn px-3 py-2 rounded-md text-sm">+ Novo Tema</button>
        </div>
        <div id="weekPub" class="space-y-2"></div>
      </section>
    </div><!-- Modal simples de Tema -->
<dialog id="modalTheme" class="rounded-2xl p-0 w-[min(900px,96vw)] bg-[#0f0f0f] text-white">
  <form method="dialog">
    <div class="p-4 border-b border-white/10 flex items-center">
      <h3 class="title text-lg">Tema</h3>
      <button class="ml-auto px-3 py-1.5 btn rounded-md">Fechar</button>
    </div>
  </form>
  <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[70vh] overflow-y-auto">
    <div class="space-y-3">
      <input id="fTitulo" placeholder="T√≠tulo" class="w-full"/>
      <input id="fPersona" placeholder="Persona" class="w-full"/>
      <input id="fObjetivo" placeholder="Objetivo/CTA" class="w-full"/>
      <label class="text-sm opacity-70">Datas</label>
      <div class="grid grid-cols-2 gap-2">
        <input id="dGravacao" type="date"/>
        <input id="dPublicacao" type="date"/>
      </div>
      <label class="text-sm opacity-70">Plataformas</label>
      <div class="flex gap-3 text-sm">
        <label class="inline-flex items-center gap-2"><input type="checkbox" id="pYT">YouTube</label>
        <label class="inline-flex items-center gap-2"><input type="checkbox" id="pIG">Instagram</label>
        <label class="inline-flex items-center gap-2"><input type="checkbox" id="pBlog">Blog</label>
      </div>
      <label class="text-sm opacity-70">Status</label>
      <select id="fStatus" class="w-full">
        <option>Ideia</option>
        <option>Rascunho</option>
        <option>Em grava√ß√£o</option>
        <option>Em edi√ß√£o</option>
        <option>Publicado</option>
      </select>
    </div>
    <div class="space-y-3">
      <label class="text-sm title">Roteiro ‚Äî YouTube</label>
      <textarea id="rYT" placeholder="T√≠tulo, thumb, intro 30s, t√≥picos, CTA" class="w-full min-h-[120px]"></textarea>
      <label class="text-sm title">Reels/Stories</label>
      <textarea id="rReels" placeholder="Hook, micro-roteiro, CTA" class="w-full min-h-[120px]"></textarea>
    </div>
  </div>
  <div class="p-4 border-t border-white/10 flex items-center gap-3">
    <button id="btnSaveTheme" class="btn px-4 py-2 rounded-lg">Salvar</button>
    <div class="ml-auto text-sm opacity-70" id="themeIdInfo"></div>
  </div>
</dialog>

  </template>  <script>
    // ====== State (LocalStorage) ======
    const STORE_KEY = 'flowon.v1';
    const Data = {
      _s: { habits: [], journal: { daily: [] }, themes: [] },
      load(){ try{ const raw = localStorage.getItem(STORE_KEY); if(raw) this._s = JSON.parse(raw); if(!this._s.habits.length){ this._s.habits = [ {id:'h1', name:'Planejar dia anterior'}, {id:'h2', name:'Treinar'}, {id:'h3', name:'Meditar 5 min'} ]; } if(!this._s.themes.length){ this._s.themes=[{id:'t1', title:'Dopamina e motiva√ß√£o no treino', persona:'Mulheres 30+', objetivo:'Levar para avalia√ß√£o', status:'Rascunho', platforms:['YouTube','Instagram'], dates:{ gravacao:'', publicacao:'' }, scripts:{ yt:'', reels:'' }}]; } }catch(e){ console.error(e) } },
      save(){ localStorage.setItem(STORE_KEY, JSON.stringify(this._s)) },
      get(){ return this._s }
    }

    // ====== Utils ======
    const toISO = d => new Date(d).toISOString().slice(0,10)
    const today = new Date()
    function weekRange(date){
      const d = new Date(date); const day = (d.getDay()+6)%7; // seg=0 ... dom=6
      const monday = new Date(d); monday.setDate(d.getDate()-day)
      const week = [...Array(7)].map((_,i)=>{ const x = new Date(monday); x.setDate(monday.getDate()+i); return toISO(x) })
      return week
    }

    // Track checks by week key "YYYY-W##"
    function weekKey(date=new Date()){
      const d=new Date(date); const onejan=new Date(d.getFullYear(),0,1); const week=Math.ceil((((d-onejan)/86400000)+onejan.getDay()+1)/7); return `${d.getFullYear()}-W${String(week).padStart(2,'0')}`
    }

    // ====== Router ======
    const routes = {
      '/': renderHome,
      '/journal': renderJournal,
      '/themes': renderThemes
    }

    function router(){
      const hash = location.hash.replace('#','') || '/'
      const [path, qs] = hash.split('?')
      const view = routes[path] || renderHome
      view(Object.fromEntries(new URLSearchParams(qs)))
    }

    window.addEventListener('hashchange', router)

    // ====== HOME ======
    function renderHome(){
      const app = document.getElementById('app');
      app.innerHTML = document.getElementById('homeTpl').innerHTML
      renderHomeHabits();
      renderHomeContent();
      renderHomeJournal();
    }

    function renderHomeHabits(){
      const el = document.getElementById('homeHabits'); el.innerHTML=''
      const s = Data.get();
      const dates = weekRange(new Date())
      s.habits.forEach(h=>{
        const wk = weekKey()
        h.checks = h.checks || {}; h.checks[wk] = h.checks[wk] || Array(7).fill(false)
        const row = document.createElement('div')
        row.className = 'flex items-center justify-between py-2 border-b border-white/5'
        row.innerHTML = `<div class="text-sm">${h.name}</div>`
        const dots = document.createElement('div'); dots.className='flex items-center gap-1'
        h.checks[wk].forEach((v,i)=>{
          const b = document.createElement('button'); b.className = 'ring-dot'+(v?' done':''); b.title = dates[i]
          b.addEventListener('click',()=>{ h.checks[wk][i]=!h.checks[wk][i]; Data.save(); renderHomeHabits() })
          dots.appendChild(b)
        })
        const pct = Math.round(100 * h.checks[wk].filter(Boolean).length / 7)
        const pctEl = document.createElement('div'); pctEl.className='text-xs opacity-70 w-10 text-right'; pctEl.textContent = pct+'%'
        const right = document.createElement('div'); right.className='flex items-center gap-3'; right.appendChild(dots); right.appendChild(pctEl)
        row.appendChild(right); el.appendChild(row)
      })
      Data.save()
    }

    function renderHomeContent(){
      const box = document.getElementById('homeContent'); box.innerHTML=''
      const s = Data.get();
      // pr√≥ximos 7 dias por data de publica√ß√£o
      const dates = weekRange(new Date())
      dates.forEach(d=>{
        const items = s.themes.filter(t=> t.dates?.publicacao === d)
        const day = document.createElement('div'); day.className='rounded-xl p-3 bg-[#101010] border border-white/5 mb-2'
        day.innerHTML = `<div class='flex items-center justify-between mb-2'><span class='text-xs opacity-70'>${new Date(d).toLocaleDateString('pt-BR',{weekday:'short', day:'2-digit'})}</span><button class='btn text-[11px] px-2 py-0.5 rounded-md' data-add='${d}'>+ Tema</button></div>`
        const list = document.createElement('div');
        if(!items.length){ list.innerHTML = `<div class='text-xs opacity-50'>Sem itens</div>` }
        items.forEach(t=>{
          const tag = (t.platforms||[]).join(' ‚Ä¢ ')
          const it = document.createElement('div'); it.className='text-xs px-2 py-1 rounded bg-black/40 border border-white/10 mb-1'
          it.textContent = `${t.title} ‚Äî ${tag}`
          list.appendChild(it)
        })
        day.appendChild(list)
        day.querySelector('[data-add]').addEventListener('click',()=>{ openThemeModal({dates:{publicacao:d}}) })
        box.appendChild(day)
      })
    }

    function renderHomeJournal(){
      const box = document.getElementById('homeJournal'); box.innerHTML=''
      const s = Data.get();
      const dates = weekRange(new Date())
      dates.forEach(d=>{
        const day = s.journal.daily.find(x=>x.date===d)
        const mood = day?.mood ? `Humor ${day.mood}/10` : '‚Äî'
        const foco = day?.focus ? `‚Ä¢ ${day.focus}` : ''
        const card = document.createElement('div'); card.className='flex items-center justify-between rounded-xl p-3 bg-[#101010] border border-white/5 mb-2'
        card.innerHTML = `<div class='text-xs opacity-70'>${new Date(d).toLocaleDateString('pt-BR',{weekday:'short', day:'2-digit'})}</div><div class='text-sm'>${mood} <span class='opacity-70'>${foco}</span></div><button class='btn text-[11px] px-2 py-0.5 rounded-md' data-add='${d}'>+ Daily</button>`
        card.querySelector('[data-add]').addEventListener('click',()=> openDailyPrompt(d))
        box.appendChild(card)
      })
    }

    // ====== JOURNAL PAGE ======
    function renderJournal(params={}){
      const app = document.getElementById('app');
      app.innerHTML = document.getElementById('journalTpl').innerHTML
      const tab = params.tab || 'habits'
      showJournalTab(tab)
      app.querySelectorAll('.tab').forEach(a=> a.addEventListener('click',()=> showJournalTab(a.dataset.tab)))
    }

    function showJournalTab(tab){
      const box = document.getElementById('journalView'); box.innerHTML=''
      if(tab==='habits') return renderHabitsTab(box)
      if(tab==='daily') return renderDailyTab(box)
      if(tab==='monthly') return renderMonthlyTab(box)
      if(tab==='quarter') return renderQuarterTab(box)
    }

    function renderHabitsTab(box){
      const s = Data.get(); const wk = weekKey()
      const dates = weekRange(new Date())
      const head = document.createElement('div'); head.className='flex items-center justify-between mb-3'
      head.innerHTML = `<h2 class='title text-lg'>H√°bitos</h2><button class='btn px-3 py-2 rounded-md text-sm' id='btnAddHabit'>+ H√°bito</button>`
      box.appendChild(head)
      const table = document.createElement('div'); table.className='glass rounded-2xl p-4'
      s.habits.forEach((h,hi)=>{
        h.checks = h.checks || {}; h.checks[wk] = h.checks[wk] || Array(7).fill(false)
        const row = document.createElement('div'); row.className='flex items-center justify-between py-3 border-b border-white/5'
        row.innerHTML = `<div class='text-sm'>${h.name}</div>`
        const dots = document.createElement('div'); dots.className='flex items-center gap-2'
        h.checks[wk].forEach((v,i)=>{
          const b = document.createElement('button'); b.className = 'ring-dot'+(v?' done':''); b.title = dates[i]
          b.addEventListener('click',()=>{ h.checks[wk][i]=!h.checks[wk][i]; Data.save(); showJournalTab('habits') })
          dots.appendChild(b)
        })
        const pct = Math.round(100 * h.checks[wk].filter(Boolean).length / 7)
        const pctEl = document.createElement('div'); pctEl.className='text-xs opacity-70 w-10 text-right'; pctEl.textContent = pct+'%'
        const right = document.createElement('div'); right.className='flex items-center gap-3'; right.appendChild(dots); right.appendChild(pctEl)
        row.appendChild(right); table.appendChild(row)
      })
      box.appendChild(table)
      document.getElementById('btnAddHabit').addEventListener('click',()=>{
        const name = prompt('Nome do h√°bito:')
        if(!name) return
        s.habits.push({ id:'h_'+Date.now(), name })
        Data.save(); showJournalTab('habits')
      })
    }

    function renderDailyTab(box){
      const s = Data.get();
      const ctrl = document.createElement('div'); ctrl.className='flex items-center gap-2 mb-3'
      ctrl.innerHTML = `<input type='date' id='dlDate' class='text-sm' value='${toISO(new Date())}'/><button class='btn px-3 py-2 rounded-md text-sm' id='btnAddDaily'>Salvar Daily</button>`
      box.appendChild(ctrl)
      const form = document.createElement('div'); form.className='grid md:grid-cols-2 gap-3'
      form.innerHTML = `
        <input id='dlFocus' placeholder='Foco do dia (1 frase)'/>
        <input id='dlMITs' placeholder='3 MITs (separe por ;)'/>
        <input id='dlGratidao' placeholder='Gratid√£o (3 itens; separados por ;)'/>
        <textarea id='dlNotes' placeholder='Notas / Reflex√£o PM' class='md:col-span-2 min-h-[120px]'></textarea><input id='dlMood' type='number' min='1' max='10' placeholder='Humor (1-10)'/>
  `
  box.appendChild(form)
  document.getElementById('btnAddDaily').addEventListener('click',()=>{
    const d = document.getElementById('dlDate').value || toISO(new Date())
    const item = { date:d, focus: dlFocus.value, mits: dlMITs.value, gratidao: dlGratidao.value, notes: dlNotes.value, mood: Number(dlMood.value||0) }
    const ix = s.journal.daily.findIndex(x=>x.date===d)
    if(ix>=0) s.journal.daily[ix]=item; else s.journal.daily.push(item)
    Data.save(); alert('Daily salvo!');
  })
  const list = document.createElement('div'); list.className='mt-4 grid gap-2'
  s.journal.daily.slice(-7).reverse().forEach(d=>{
    const card = document.createElement('div'); card.className='rounded-xl p-3 bg-[#101010] border border-white/5'
    card.innerHTML = `<div class='text-sm title'>${new Date(d.date).toLocaleDateString('pt-BR')}</div><div class='text-xs opacity-70'>Humor: ${d.mood||'‚Äî'} ‚Ä¢ Foco: ${d.focus||'‚Äî'}</div><div class='text-[11px] opacity-60 mt-1'>Gratid√£o: ${(d.gratidao||'‚Äî')}</div>`
    list.appendChild(card)
  })
  box.appendChild(list)
})
  // √öltimos 7
  const list = document.createElement('div'); list.className='mt-4 grid gap-2'
  s.journal.daily.slice(-7).reverse().forEach(d=>{
    const card = document.createElement('div'); card.className='rounded-xl p-3 bg-[#101010] border border-white/5'
    card.innerHTML = `<div class='text-sm title'>${new Date(d.date).toLocaleDateString('pt-BR')}</div><div class='text-xs opacity-70'>Humor: ${d.mood||'‚Äî'} ‚Ä¢ Foco: ${d.focus||'‚Äî'}</div>`
    list.appendChild(card)
  })
  box.appendChild(list)
}

function renderMonthlyTab(box){
  const s = Data.get();
  const wrap = document.createElement('div'); wrap.className='glass rounded-2xl p-4'
  const thisMonth = new Date().toISOString().slice(0,7)
  const monthDailies = s.journal.daily.filter(d=> (d.date||'').startsWith(thisMonth))
  const moods = monthDailies.map(d=>d.mood).filter(Boolean)
  const avg = moods.length? (moods.reduce((a,b)=>a+b,0)/moods.length).toFixed(1) : '‚Äî'
  const counts = {}
  monthDailies.forEach(d=>{ (d.gratidao||'').split(/;|,|

/).map(x=>x.trim()).filter(Boolean).forEach(g=>{ counts[g]=(counts[g]||0)+1 }) }) const top = Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,5) const topList = top.length? top.map(([k,v])=><li class='text-sm'>${k} <span class='opacity-60'>(x${v})</span></li>).join('') : <li class='text-sm opacity-60'>Sem registros de gratid√£o ainda.</li> wrap.innerHTML = <h2 class='title text-lg mb-2'>Monthly Log</h2> <div class='text-sm opacity-80 mb-2'>Humor m√©dio do m√™s: <b>${avg}</b></div> <div class='mb-3'> <div class='title text-sm mb-1'>Marcos de Gratid√£o (Top 5)</div> <ul class='list-disc pl-5 space-y-1'>${topList}</ul> </div> <div class='divider my-3'></div> <textarea id='monthlyNotes' placeholder='Vit√≥rias, travas, aprendizados...' class='w-full min-h-[140px]'></textarea> box.appendChild(wrap) }

function renderQuarterTab(box){
  const wrap = document.createElement('div'); wrap.className='glass rounded-2xl p-4'
  wrap.innerHTML = `<h2 class='title text-lg mb-2'>Trimestral Log</h2><div class='grid md:grid-cols-3 gap-3'><textarea placeholder='Metas do ciclo'></textarea><textarea placeholder='H√°bitos a refor√ßar'></textarea><textarea placeholder='H√°bitos a substituir'></textarea></div>`
  box.appendChild(wrap)
}

function openDailyPrompt(dateISO){
  const s = Data.get();
  const focus = prompt(`Daily ${new Date(dateISO).toLocaleDateString('pt-BR')} ‚Äî foco do dia:`) || ''
  const mood = Number(prompt('Humor (1-10):')||0)
  const item = { date:dateISO, focus, mood, mits:'', notes:'' }
  const ix = s.journal.daily.findIndex(x=>x.date===dateISO)
  if(ix>=0) s.journal.daily[ix]=item; else s.journal.daily.push(item)
  Data.save(); router()
}

// ====== THEMES PAGE ======
let editingId = null
function renderThemes(){
  const app = document.getElementById('app');
  app.innerHTML = document.getElementById('themesTpl').innerHTML
  drawIdeas(); drawDrafts(); drawWeekPub();
  document.getElementById('btnAddIdea').addEventListener('click',()=>{
  const title = prompt('T√≠tulo da ideia:'); if(!title) return
  Data.get().themes.push({ id:'t_'+Date.now(), title, status:'Ideia', persona:'', objetivo:'', platforms:[], dates:{ gravacao:'', publicacao:'' }, scripts:{ yt:'', reels:'' }, archived:false })
  Data.save(); drawIdeas();
})
    Data.save(); drawIdeas();
  })
  document.getElementById('btnNewTheme').addEventListener('click',()=> openThemeModal({}))
}

function drawIdeas(){
  const box = document.getElementById('ideasList'); box.innerHTML=''
  Data.get().themes.filter(t=>t.status==='Ideia').forEach(t=>{
    const row = document.createElement('div'); row.className='flex items-center justify-between px-3 py-2 rounded-lg bg-[#101010] border border-white/5'
    row.innerHTML = `<div class='text-sm'>${t.title}</div><div class='flex items-center gap-2'><button class='btn px-2 py-1 rounded-md text-xs' data-edit='${t.id}'>Rascunhar</button><button class='btn px-2 py-1 rounded-md text-xs' data-del='${t.id}'>Excluir</button></div>`
    row.querySelector('[data-edit]').addEventListener('click',()=>{ t.status='Rascunho'; Data.save(); drawIdeas(); drawDrafts() })
    row.querySelector('[data-del]').addEventListener('click',()=>{ const s=Data.get(); s.themes=s.themes.filter(x=>x.id!==t.id); Data.save(); drawIdeas() })
    box.appendChild(row)
  })
}

function drawDrafts(){
  const box = document.getElementById('draftsList'); box.innerHTML=''
  Data.get().themes.filter(t=>t.status!=='Ideia').forEach(t=>{
    const row = document.createElement('div'); row.className='px-3 py-2 rounded-lg bg-[#101010] border border-white/5'
    row.innerHTML = `<div class='flex items-center justify-between'><div><div class='title text-sm'>${t.title}</div><div class='text-xs opacity-70 mt-0.5'>${(t.platforms||[]).join(' ‚Ä¢ ')||'‚Äî'} ‚Ä¢ Pub.: ${t.dates?.publicacao||'‚Äî'}</div></div><div class='flex gap-2'><button class='btn px-2 py-1 rounded-md text-xs' data-open='${t.id}'>Abrir</button><button class='btn px-2 py-1 rounded-md text-xs' data-del='${t.id}'>Excluir</button></div></div>`
    row.querySelector('[data-open]').addEventListener('click',()=> openThemeModal(t))
    row.querySelector('[data-del]').addEventListener('click',()=>{ const s=Data.get(); s.themes=s.themes.filter(x=>x.id!==t.id); Data.save(); drawDrafts(); drawWeekPub() })
    box.appendChild(row)
  })
}

function drawWeekPub(){
  const box = document.getElementById('weekPub'); box.innerHTML=''
  const dates = weekRange(new Date())
  dates.forEach(d=>{
    const items = Data.get().themes.filter(t=> t.dates?.publicacao === d)
    const day = document.createElement('div'); day.className='rounded-xl p-3 bg-[#101010] border border-white/5'
    day.innerHTML = `<div class='flex items-center justify-between mb-2'><span class='text-xs opacity-70'>${new Date(d).toLocaleDateString('pt-BR',{weekday:'short', day:'2-digit'})}</span><button class='btn text-[11px] px-2 py-0.5 rounded-md' data-add='${d}'>+ Tema</button></div>`
    const list = document.createElement('div');
    if(!items.length){ list.innerHTML = `<div class='text-xs opacity-50'>Sem itens</div>` }
    items.forEach(t=>{
      const it = document.createElement('div'); it.className='text-xs px-2 py-1 rounded bg-black/40 border border-white/10 mb-1'
      it.textContent = `${t.title} ‚Äî ${(t.platforms||[]).join(' ‚Ä¢ ')}`
      list.appendChild(it)
    })
    day.appendChild(list)
    day.querySelector('[data-add]').addEventListener('click',()=> openThemeModal({dates:{publicacao:d}}))
    box.appendChild(day)
  })
}

function openThemeModal(data){
  const s = Data.get();
  const modal = document.querySelector('#modalTheme');
  modal.showModal();
  editingId = data.id || null
  fTitulo.value = data.title||''; fPersona.value=data.persona||''; fObjetivo.value=data.objetivo||'';
  dGravacao.value = data.dates?.gravacao||''; dPublicacao.value = data.dates?.publicacao||'';
  pYT.checked = !!data.platforms?.includes('YouTube'); pIG.checked=!!data.platforms?.includes('Instagram'); pBlog.checked=!!data.platforms?.includes('Blog');
  fStatus.value = data.status||'Ideia'; rYT.value=data.scripts?.yt||''; rReels.value=data.scripts?.reels||'';
  themeIdInfo.textContent = editingId || 'novo'
  document.getElementById('btnSaveTheme').onclick = ()=>{
    let status = fStatus.value
    const hasPub = !!dPublicacao.value
    if(status==='Ideia') status = 'Rascunho'
    if(hasPub) status = 'Agendado'
    const obj = {
      id: editingId || ('t_'+Date.now()),
      title: fTitulo.value.trim(), persona:fPersona.value.trim(), objetivo:fObjetivo.value.trim(),
      platforms: [pYT.checked&&'YouTube', pIG.checked&&'Instagram', pBlog.checked&&'Blog'].filter(Boolean),
      status,
      dates: { gravacao:dGravacao.value, publicacao:dPublicacao.value },
      scripts: { yt:rYT.value, reels:rReels.value },
      archived: data.archived||false
    }
    const ix = s.themes.findIndex(x=>x.id===obj.id)
    if(ix>=0) s.themes[ix]=obj; else s.themes.push(obj)
    Data.save(); modal.close(); drawIdeas(); drawDrafts(); drawWeekPub(); router()
  }
}
    const ix = s.themes.findIndex(x=>x.id===obj.id)
    if(ix>=0) s.themes[ix]=obj; else s.themes.push(obj)
    Data.save(); modal.close(); drawDrafts(); drawWeekPub(); router()
  }
}

// ====== BOOT ======
Data.load();
router();

  </script>
</body>
</html>

